<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="../assets/icon.png">

  <title>Prueba de series | UCC</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="../assets/styles.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/underscore@1.13.1/underscore-umd-min.js"></script>
  <script src="../assets/bundle.js"></script>
  <script src="../assets/app.js"></script>
</head>

<body class="h-100">

  <nav class="navbar navbar-expand-md navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">UCC</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Inicio</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="numeros-aleatorios" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              Números aleatorios
            </a>
            <ul class="dropdown-menu" aria-labelledby="numeros-aleatorios">
              <li>
                <a class="dropdown-item" href="aleatorios-uniforme.html">Distribución uniforme</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-normal.html">Distribución normal</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-bernoulli.html">Distribución Bernoulli</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-beta.html">Distribución beta</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-binomial.html">Distribución binomial</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-chi-cuadrado.html">Distribución chi cuadrado</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-chi.html">Distribución chi</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-exponencial.html">Distribución exponencial</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-gamma.html">Distribución gamma</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-pareto.html">Distribución pareto</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-poisson.html">Distribución poisson</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-triangular.html">Distribución triangular</a>
              </li>


            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="pruebas-bondad" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              Bondad de ajuste
            </a>
            <ul class="dropdown-menu" aria-labelledby="pruebas-bondad">
              <li>
                <a class="dropdown-item" href="prueba-mvc.html">Prueba de medias, varianza y corridas</a>
              </li>
              <li>
                <a class="dropdown-item" href="prueba-series.html">Prueba de series</a>
              </li>
              <li>
                <a class="dropdown-item" href="prueba-poker.html">Prueba de poker</a>
              </li>
              <li>
                <a class="dropdown-item" href="prueba-chi-cuadrado-normal.html">Chi-Cuadrado (normal)</a>
              </li>
              <li>
                <a class="dropdown-item" href="prueba-chi-cuadrado-exponencial.html">Chi-Cuadrado (Exponencial)</a>
              </li>
            </ul>
          </li>
        </ul>

        <a href="https://github.com/pedrazadixon/ucc-tvs/" target="_blank">
          <i class="bi bi-github mx-3" style="color: white; font-size: 22px;"></i>
        </a>

        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              es
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="https://pedrazadixon.github.io/ucc-tvs/es/prueba-series.html">Español</a></li>
              <li><a class="dropdown-item" href="https://pedrazadixon.github.io/ucc-tvs/en/prueba-series.html">English</a></li>
            </ul>
          </li>
        </ul>

      </div>
    </div>
  </nav>

  <div class="row h-100 m-3">
    <div class="col-2">
        <div class="mb-3">
            <label class="form-label">Nivel de confianza</label>
            <input type="number" class="form-control form-control-sm" id="confianza" value="95" />
        </div>

        <div class="row mb-3">
            <label class="form-label">Cuadrantes en X y Y</label>
            <div class="col-6">
                <!-- <label class="form-label">Cuadrantes X</label> -->
                <input type="number" class="form-control form-control-sm" id="cuadrantes-x" value="4" />
            </div>

            <div class="col-6">
                <!-- <label class="form-label">Cuadrantes Y</label> -->
                <input type="number" class="form-control form-control-sm" id="cuadrantes-y" value="4" />
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Números aleatorios</label>
            <textarea style="min-height: 400px" class="form-control form-control-sm" id="numeros_aleatorios">
          0.872
          0.219
          0.57
          0.618
          0.291
          0.913
          0.95
          0.041
          0.842
          0.512
          0.151
          0.511
          0.343
          0.036
          0.706
          0.462
          0.596
          0.586
          0.058
          0.213
          0.809
          0.005
          0.443
          0.608
          0.384
          0.946
          0.3
          0.203
          0.868
          0.879
        </textarea>
        </div>

        <div class="row mt-3 px-3">
            <button class="btn btn-primary" onclick="ejecutarPrueba()">
                Ejecutar
            </button>
        </div>
    </div>

    <div class="col-2 contenido" style="display: none">
        <div class="card mt-2">
            <div class="card-body">
                <table class="table table-sm" id="pares-cordenadas"></table>
            </div>
        </div>
    </div>

    <div class="col-8 contenido" style="display: none">
        <div id="chart-container"></div>

        <div class="card mt-2">
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td><b>Ji- cuadrado series:</b></td>
                        <td><span class="t_ji"></span></td>
                    </tr>
                    <tr>
                        <td><b>Ji- cuadrado alpha:</b></td>
                        <td><span id="ji_alpha"></span></td>
                    </tr>
                    <tr>
                        <td><b>Desición:</b></td>
                        <td>
                            <b><span id="desicion"></span></b>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="card mt-2">
            <div class="card-body">
                <table class="table table-sm" id="intervalos"></table>
            </div>
        </div>

        <div class="card mt-2">
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td><b>Total Intevalos:</b></td>
                        <td><b>Total Oi:</b></td>
                        <td><b>Total Ei:</b></td>
                        <td><b>Total Ji cuadrado:</b></td>
                    </tr>
                    <tr>
                        <td><span id="t_in"></span></td>
                        <td><span id="t_oi"></span></td>
                        <td><span id="t_ei"></span></td>
                        <td><span class="t_ji"></span></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    var ejecutarPrueba = function () {
        var lineas = $("#numeros_aleatorios").val().split("\n");

        var puntos = [];

        for (var i = 0; i < lineas.length; i++) {
            var valor = lineas[i].trim();
            if (valor !== "") {
                if (lineas[i + 1] === undefined) continue;
                if (lineas[i + 1].trim() == "") continue;
                puntos[i] = [
                    parseFloat(lineas[i].replace(",", ".")),
                    parseFloat(lineas[i + 1].replace(",", ".")),
                ];
            }
        }

        var cuadrantes_x = parseInt($("#cuadrantes-x").val());
        var cuadrantes_y = parseInt($("#cuadrantes-y").val());

        var dividido_x = 1.0 / cuadrantes_x;
        var dividido_y = 1.0 / cuadrantes_y;
        var lim_c_x = 0;
        var lim_c_y = 0;

        var cuadrantes = [];
        for (let x = 1; x <= cuadrantes_x; x++) {
            lim_c_y = 0;
            for (let y = 1; y <= cuadrantes_y; y++) {
                cuadrantes.push([
                    lim_c_x,
                    lim_c_x + dividido_x,
                    lim_c_y,
                    lim_c_y + dividido_y,
                ]);
                lim_c_y += dividido_y;
            }
            lim_c_x += dividido_x;
        }

        var puntos_x_cuadrante = [];
        for (let c = 0; c < cuadrantes.length; c++) {
            puntos_x_cuadrante[c] = 0;
            for (let p = 0; p < puntos.length; p++) {
                if (
                    puntos[p][0] >= cuadrantes[c][0] &&
                    puntos[p][0] < cuadrantes[c][1] &&
                    puntos[p][1] >= cuadrantes[c][2] &&
                    puntos[p][1] < cuadrantes[c][3]
                ) {
                    puntos_x_cuadrante[c]++;
                }
            }
        }

        var Oi_total = 0;
        var Ei_total = 0;
        var Ji_total = 0;

        var intevalos = [];
        for (let i = 0; i < puntos_x_cuadrante.length; i++) {
            intevalos[i] = {
                invervalo: i + 1,
                Oi: puntos_x_cuadrante[i],
                Ei: (puntos.length / cuadrantes.length).toFixed(4),
                Ji: (
                    (puntos.length / cuadrantes.length - puntos_x_cuadrante[i]) ** 2 /
                    (puntos.length / cuadrantes.length)
                ).toFixed(8),
            };

            Oi_total += parseFloat(intevalos[i].Oi);
            Ei_total += parseFloat(intevalos[i].Ei);
            Ji_total += parseFloat(intevalos[i].Ji);
        }

        Ei_total = Ei_total.toFixed(4);
        Ji_total = Ji_total.toFixed(8);

        var ji_alpha = jStat.chisquare.inv(
            parseFloat($("#confianza").val()) / 100,
            cuadrantes.length - 1
        );

        var desicion = Ji_total < ji_alpha ? "Se acepta Ho" : "Se rechaza Ho";

        // relleno interfaz grafica

        $("#desicion").text(desicion);

        $("#pares-cordenadas").empty();
        var table = document.getElementById("pares-cordenadas");
        var row = table.insertRow(0);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        cell1.innerHTML = "<b>X</b>";
        cell2.innerHTML = "<b>Y</b>";

        for (let p = 0; p < puntos.length; p++) {
            var row = table.insertRow(p + 1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            cell1.innerHTML = puntos[p][0];
            cell2.innerHTML = puntos[p][1];
        }

        $("#intervalos").empty();
        var table = document.getElementById("intervalos");
        var row = table.insertRow(0);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        cell1.innerHTML = "<b>Intervalo</b>";
        cell2.innerHTML = "<b>Oi</b>";
        cell3.innerHTML = "<b>Ei</b>";
        cell4.innerHTML = "<b>Ji cuadrado</b>";

        for (let i = 0; i < intevalos.length; i++) {
            var row = table.insertRow(intevalos[i].invervalo);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            cell1.innerHTML = intevalos[i].invervalo;
            cell2.innerHTML = intevalos[i].Oi;
            cell3.innerHTML = intevalos[i].Ei;
            cell4.innerHTML = intevalos[i].Ji;
        }

        $("#t_in").text(intevalos.length);
        $("#t_oi").text(Oi_total);
        $("#t_ei").text(Ei_total);
        $(".t_ji").text(Ji_total);
        $("#ji_alpha").text(ji_alpha.toFixed(8));

        $(".contenido").show();

        graficar(puntos, cuadrantes_x, cuadrantes_y);
    };

    var graficar = function (puntos, c_x, c_y) {
        var options = {
            series: [
                {
                    name: "PUNTO",
                    data: puntos,
                },
            ],
            chart: {
                height: 500,
                // width: 500,
                type: "scatter",
                zoom: {
                    enabled: false,
                    type: "xy",
                },
            },

            grid: {
                xaxis: {
                    lines: {
                        show: true,
                    },
                },
                yaxis: {
                    lines: {
                        show: true,
                    },
                },
            },

            xaxis: {
                tickAmount: c_x,
                min: 0,
                max: 1,
                labels: {
                    formatter: function (val) {
                        return parseFloat(val).toFixed(2);
                    },
                },
            },
            yaxis: {
                tickAmount: c_y,
                min: 0,
                max: 1,
                labels: {
                    formatter: function (val) {
                        return parseFloat(val).toFixed(2);
                    },
                },
            },
        };

        $("#chart-container").empty();
        var chartDiv = document.createElement("div");
        chartDiv.setAttribute("id", "chart");
        $("#chart-container").append(chartDiv);

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
    };
</script>

  <footer class="footer bg-dark">
    <div class="footer-div">
      <span class="text-muted">Técnicas de Validación y Simulación. - 2021</span>
    </div>
  </footer>

</body>

</html>