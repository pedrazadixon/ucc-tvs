<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="../assets/icon.png">

  <title>Prueba de Poker | UCC</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="../assets/styles.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/underscore@1.13.1/underscore-umd-min.js"></script>
  <script src="../assets/bundle.js"></script>
  <script src="../assets/app.js"></script>
</head>

<body class="h-100">

  <nav class="navbar navbar-expand-md navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">UCC</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="numeros-aleatorios" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              Ramdom numbers
            </a>
            <ul class="dropdown-menu" aria-labelledby="numeros-aleatorios">
              <li>
                <a class="dropdown-item" href="aleatorios-uniforme.html">Uniform distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-normal.html">Normal distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-bernoulli.html">Bernoulli distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-beta.html">Beta distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-binomial.html">Binomial distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-chi-cuadrado.html">Chi Square distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-chi.html">Chi distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-exponencial.html">Exponential distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-gamma.html">Gamma distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-pareto.html">Pareto distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-poisson.html">Poisson distribution</a>
              </li>
              <li>
                <a class="dropdown-item" href="aleatorios-triangular.html">Triangular distribution</a>
              </li>


            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="pruebas-bondad" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              Goodness of fit
            </a>
            <ul class="dropdown-menu" aria-labelledby="pruebas-bondad">
              <li>
                <a class="dropdown-item" href="prueba-mvc.html">Prueba de medias, varianza y corridas</a>
              </li>
              <li>
                <a class="dropdown-item" href="prueba-series.html">Prueba de series</a>
              </li>
              <li>
                <a class="dropdown-item" href="prueba-poker.html">Prueba de poker</a>
              </li>
              <li>
                <a class="dropdown-item" href="prueba-chi-cuadrado-normal.html">Chi-squared test (normal)</a>
              </li>
              <li>
                <a class="dropdown-item" href="prueba-chi-cuadrado-exponencial.html">Chi-squared test (exponential)</a>
              </li>
            </ul>
          </li>
        </ul>

        <a href="https://github.com/pedrazadixon/ucc-tvs/" target="_blank">
          <i class="bi bi-github mx-3" style="color: white; font-size: 22px;"></i>
        </a>

        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              en
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="https://pedrazadixon.github.io/ucc-tvs/es/prueba-poker.html">Español</a></li>
              <li><a class="dropdown-item" href="https://pedrazadixon.github.io/ucc-tvs/en/prueba-poker.html">English</a></li>
            </ul>
          </li>
        </ul>

      </div>
    </div>
  </nav>

  <div class="row h-100 m-3">
    <div class="col-2">
        <div class="row" style="min-height: 400px">
            <textarea id="numeros_aleatorios" class="min-vh-50">
              0.06141
              0.81792
              0.52953
              0.04127
              0.27813
              0.72484
              0.48999
              0.50502
              0.67347
              0.62182
              0.94107
              0.1859
              0.30444
              0.28103
              0.82578
              0.56766
              0.0606
              0.70688
              0.99367
              0.85923
              0.14411
              0.11223
              0.25357
              0.44598
              0.51483
              0.87648
              0.64794
              0.31555
              0.73997
              0.09099      
            </textarea>
        </div>

        <div class="row mt-3">
            <button class="btn btn-primary" onclick="ejecutarPrueba()">
                Ejecutar
            </button>
        </div>
    </div>

    <div class="col-10" id="contenido" style="display: none">
        <div class="card mt-2">
            <div class="card-body">
                <table id="tablaPokerResumen">
                    <thead>
                        <tr>
                            <th>Cagetegorias</th>
                            <th>FO</th>
                            <th>FE</th>
                            <th>JI Poker</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="card mt-2">
            <div class="card-body">
                <table class="table">
                    <tr>
                        <td><b>Total Categorias:</b></td>
                        <td><b>Frecuencia Observada:</b></td>
                        <td><b>Frecuencia Esperada:</b></td>
                        <td><b>Ji Poker:</b></td>
                    </tr>
                    <tr>
                        <td><span id="tc"></span></td>
                        <td><span id="fo"></span></td>
                        <td><span id="fe"></span></td>
                        <td><span id="ji"></span></td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="card mt-2">
            <div class="card-body">
                <table class="table">
                    <tr>
                        <td><b>Ji- Póker:</b></td>
                        <td><span id="ji_poker"></span></td>
                    </tr>
                    <tr>
                        <td><b>Ji- Alpha:</b></td>
                        <td><span id="ji_alpha"></span></td>
                    </tr>
                    <tr>
                        <td><b>Desicion:</b></td>
                        <td><span id="desicion"></span></td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="card mt-2">
            <div class="card-body">
                <table id="tablaPoker">
                    <thead>
                        <tr>
                            <th>Numeros Aleatorios</th>
                            <th>Procesado</th>
                            <th>Categoria</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    var cant_decimales = 5;

    var probabilidad = {
        TD: 0.3024,
        "1P": 0.504,
        "2P": 0.108,
        "1T": 0.072,
        FULL: 0.009,
        POKER: 0.0045,
        "1Q": 0.0001,
    };

    var categorias = {
        TD: 0,
        "1P": 0,
        "2P": 0,
        "1T": 0,
        FULL: 0,
        POKER: 0,
        "1Q": 0,
    };

    var total_fo = 0;
    var total_fe = 0;

    var procesarNumero = function (numero) {
        var valor_recortado = numero.substring(2, cant_decimales + 2);

        if (valor_recortado.length < cant_decimales) {
            var ceros_faltantes = cant_decimales - valor_recortado.length;
            for (let k = 1; k <= ceros_faltantes; k++) {
                valor_recortado = valor_recortado + "0";
            }
        }

        var conteos = {};

        for (let i = 0; i < valor_recortado.length; i++) {
            const element = valor_recortado[i];

            conteos[valor_recortado[i]] =
                valor_recortado.split(valor_recortado[i]).length - 1;
        }

        var pares = 0;
        var tercias = 0;
        var poker = 0;
        var quitillas = 0;
        var diferentes = 0;

        for (const propiedad in conteos) {
            if (conteos[propiedad] == 1) diferentes++;
            if (conteos[propiedad] == 2) pares++;
            if (conteos[propiedad] == 3) tercias++;
            if (conteos[propiedad] == 4) poker++;
            if (conteos[propiedad] == 5) quitillas++;
        }

        if (poker == 1)
            return {valor_procesado: valor_recortado, categoria: "POKER"};

        if (quitillas == 1)
            return {valor_procesado: valor_recortado, categoria: "1Q"};

        if (diferentes == cant_decimales)
            return {valor_procesado: valor_recortado, categoria: "TD"};

        if (pares == 2)
            return {valor_procesado: valor_recortado, categoria: "2P"};

        if (pares == 1 && tercias == 1)
            return {valor_procesado: valor_recortado, categoria: "FULL"};

        if (pares == 1 && diferentes == 3)
            return {valor_procesado: valor_recortado, categoria: "1P"};

        if (tercias == 1 && diferentes == 2)
            return {valor_procesado: valor_recortado, categoria: "1T"};
    };

    var ejecutarPrueba = function () {
        // reset variables
        for (const categoria in categorias) {
            categorias[categoria] = 0;
        }

        total_fo = 0;
        total_fe = 0;

        $("#contenido").show();

        var tablaNumeros = [];

        $("#tablaPoker").DataTable().destroy();
        $("#tablaPokerResumen").DataTable().destroy();

        var lineas = $("#numeros_aleatorios").val().split("\n");

        var total_numeros = 0;

        for (var i = 0; i < lineas.length; i++) {
            var valor = lineas[i].trim();
            if (valor !== "") {
                total_numeros++;

                var procesado = procesarNumero(valor);

                categorias[procesado.categoria] = categorias[procesado.categoria] + 1;

                tablaNumeros.push({
                    numero_aleatorio: valor,
                    numero_procesado: procesado.valor_procesado,
                    categoria: procesado.categoria,
                });
            }
        }

        tablaResumen = [];
        for (const cagetoria in categorias) {
            var fe = (probabilidad[cagetoria] * total_numeros).toFixed(4);
            var ji = ((fe - categorias[cagetoria]) ** 2 / fe).toFixed(7);

            tablaResumen.push({
                categoria: cagetoria,
                fo: categorias[cagetoria],
                fe: fe,
                ji: ji,
            });

            // totales
            total_fe = parseFloat(total_fe) + parseFloat(fe);
            total_fo = parseFloat(total_fo) + parseFloat(ji);
        }

        var ji_alpha = jStat.chisquare.inv(0.95, 6);

        // muestro los totales en pantalla
        $("#tc").text(7);
        $("#fo").text(total_numeros);
        $("#fe").text(total_fe.toFixed(2));
        $("#ji").text(total_fo.toFixed(7));
        $("#ji_poker").text(total_fo.toFixed(7));
        $("#ji_alpha").text(ji_alpha.toFixed(8));
        $("#desicion").text(
            total_fo < ji_alpha ? "Se rechaza la Ho." : "Se acepta la Ho."
        );

        $("#tablaPokerResumen").DataTable({
            paging: false,
            bInfo: false,
            bFilter: false,
            ordering: false,
            data: tablaResumen,
            columns: [
                {data: "categoria"},
                {data: "fo"},
                {data: "fe"},
                {data: "ji"},
            ],
        });

        $("#tablaPoker").DataTable({
            paging: false,
            ordering: false,
            data: tablaNumeros,
            columns: [
                {data: "numero_aleatorio"},
                {data: "numero_procesado"},
                {data: "categoria"},
            ],
        });
    };
</script>

  <footer class="footer bg-dark">
    <div class="footer-div">
      <span class="text-muted">Validation and Simulation Techniques. - 2021</span>
    </div>
  </footer>

</body>

</html>